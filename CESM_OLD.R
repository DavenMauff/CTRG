library(dplyr)
library(tidyverse)

cesmData <- read.csv(file="second_order_CESM.csv",header=TRUE, sep=",")

cesmData$category <- case_when(
  cesmData$category == "Accounting And Related Services" | cesmData$category == "Taxation" ~"Accounting",
  cesmData$category == "Agricultural Business And Management" | cesmData$category == "Agricultural Mechanisation" | cesmData$category == "Agricultural Production Operations" | cesmData$category == "Agricultural/Biological Engineering And Bio-Engineering" | cesmData$category == "Agriculture, Agricultural Operations and Related Sciences, Other" | cesmData$category == "Applied Horticulture And Horticultural Business Services" | cesmData$category == "Forest Engineering" | cesmData$category == "Forestry And Wood Sciences" | cesmData$category == "Plant Sciences" | cesmData$category == "Soil Sciences" ~"Agriculture",
  cesmData$category == "Architectural And Built Environment Technology" | cesmData$category == "Architectural Engineering" | cesmData$category == "Architectural History And Criticism" | cesmData$category == "Architecture and the Built Environment, Other" | cesmData$category == "Architecture, General" | cesmData$category == "City/Urban, Community And Regional Planning" | cesmData$category == "Environmental Design/Architecture" | cesmData$category == "Interior Architecture And Design" | cesmData$category == "Landscape Architecture" | cesmData$category == "Quantity Surveying" ~"Architecture",
  cesmData$category == "Civil Engineering" | cesmData$category == "Construction Engineering" | cesmData$category == "Surveying Engineering" ~"Civil Engineers",
  cesmData$category == "Computer And Information Sciences" | cesmData$category == "Computer and Information Sciences, Other" | cesmData$category == "Computer Business Systems Analysis" | cesmData$category == "Computer Engineering" | cesmData$category == "Computer Programming" | cesmData$category == "Computer Science" | cesmData$category == "Computer Software And Media Applications" | cesmData$category == "Computer Systems Networking And Telecommunications" | cesmData$category == "Computer/Information Technology Administration And Management" | cesmData$category == "Data Entry/Microcomputer Applications" | cesmData$category == "Data Processing And Information Science" | cesmData$category == "Management Information Systems And Services" ~"Computing",
  cesmData$category == "Apparel And Textiles" | cesmData$category == "Design And Applied Arts" ~"Design",
  cesmData$category == "Afrikaans Language And Literature" | cesmData$category == "Asian Languages And Literature" | cesmData$category == "Classics And Classical Languages And Literature" | cesmData$category == "Comparative African Languages And Literatures" | cesmData$category == "Counsellor Education And Guidance Services" | cesmData$category == "Curriculum And Instruction" | cesmData$category == "Dutch Language And Literature" | cesmData$category == "Education, General" | cesmData$category == "Education, Other" | cesmData$category == "Educational Assessment, Evaluation And Research" | cesmData$category == "Educational Management And Leadership" | cesmData$category == "Educational Psychology" | cesmData$category == "Educational/Instructional Media Design" | cesmData$category == "English Language And Literature" | cesmData$category == "European Languages And Literature (Excluding Dutch)" | cesmData$category == "Foundations of Education" | cesmData$category == "International And Comparative Education" | cesmData$category == "Isindebele Language And Literature" | cesmData$category == "Isixhosa Language And Literature" | cesmData$category == "Isizulu Language And Literature" | cesmData$category == "Languages, Linguistics and Literature, Other" | cesmData$category == "Linguistic, Comparative And Related Language Studies And Practices" | cesmData$category == "Middle/Near Eastern And Semitic Languages And Literature" | cesmData$category == "Other African Languages And Literature" | cesmData$category == "Other fields of study in education" | cesmData$category == "Public Administration" | cesmData$category == "Sepedi Language And Literature" | cesmData$category == "Sesotho Language And Literature" | cesmData$category == "Setswana Language And Literature" | cesmData$category == "Siswati Language And Literature" | cesmData$category == "Social And Philosophical Foundations Of Education" | cesmData$category =="South African Sign Language (Sasl)" | cesmData$category == "Special Needs Education" | cesmData$category == "Teacher Education And Professional Development, Specific Levels And Methods" | cesmData$category == "Teacher Education And Professional Development, Specific Subject Areas, Early" | cesmData$category == "Childhood Development (Ecd) And General Education And Training (Get)" | cesmData$category == "Teacher Education And Professional Development, Specific Subject Areas, Further" | cesmData$category == "Education And Training (Fet)" | cesmData$category == "Teaching and Learning Support" | cesmData$category == "Teaching, Leading and Researching in Community and Adult Education and Training Contexts" | cesmData$category == "Teaching, Leading and Researching in Early Childhood Education and Development Contexts" | cesmData$category == "Teaching, Leading and Researching in Higher Education" | cesmData$category == "Teaching; Leading and Researching in Schooling Contexts (Further Education and Training (FET) Phase)" | cesmData$category == "Teaching; Leading and Researching in Schooling Contexts (Grade R and Foundation Phase)" | cesmData$category == "Teaching; Leading and Researching in Schooling Contexts (Inter-mediate Phase)" | cesmData$category == "Teaching; Leading and Researching in Schooling Contexts (Senior Phase)" | cesmData$category == "Teaching; leading and researching in Technical and Vocational Education and Training (TVET) contexts" | cesmData$category == "Tshivenda Language And Literature" | cesmData$category == "Xitsonga Language And Literature" ~"Education",
  cesmData$category == "Electrical, Electronics And Communications Engineering" ~"Electrical Engineers",
  cesmData$category == "Human Resource Management and Services" ~"Human Resources",
  cesmData$category == "Library Science/Librarianship" | cesmData$category == "Museology/Museum Studies" ~"Information Science",
  cesmData$category == "Finance and Financial Management Services" | cesmData$category == "Insurance" ~"Insurance/Finance",
  cesmData$category == "Accounting And Related Services" | cesmData$category == "Taxation" ~"Accounting",
  cesmData$category == "Agricultural Business And Management" | cesmData$category == "Agricultural Mechanisation" | cesmData$category == "Agricultural Production Operations" | cesmData$category == "Agricultural/Biological Engineering And Bio-Engineering" | cesmData$category == "Agriculture, Agricultural Operations and Related Sciences, Other" | cesmData$category == "Applied Horticulture And Horticultural Business Services" | cesmData$category == "Forest Engineering" | cesmData$category == "Forestry And Wood Sciences" | cesmData$category == "Plant Sciences" | cesmData$category == "Soil Sciences" ~"Agriculture",
  cesmData$category == "Radio, Television And Digital Communication" | cesmData$category == "Publishing" | cesmData$category == "Journalism" | cesmData$category == "Communication, Journalism and Related Studies, Other" | cesmData$category == "Communication And Media Studies" ~ "Writing/Journalism",
  cesmData$category == "Theology" | cesmData$category == "Religion" | cesmData$category == "Philosophy, Religion and Theology, Other" ~ "Theology",
  cesmData$category == "Social Work" | cesmData$category == "Human Services" | cesmData$category == "Community Psychology" | cesmData$category == "Community Organisation and Advocacy" ~ "Social Work",
  cesmData$category == "Specialised Sales, Merchandising And Marketing Operations" | cesmData$category == "Real Estate" | cesmData$category == "General Sales, Merchandising And Related Marketing Operations" ~ "Sales",
  cesmData$category == "Nursing" ~ "Nursing",
  cesmData$category == "Systems Engineering" | cesmData$category == "Public Management and Services, Other" | cesmData$category == "Management Sciences And Quantitative Methods" | cesmData$category == "Entrepreneurial and Small Business Operations" | cesmData$category == "Business Administration, Management And Operations" | cesmData$category == "Business, Economics and Management Studies, Other" | cesmData$category == "Business/Corporate Communications" ~ "Management/Logistics",
  cesmData$category == "Public Law" | cesmData$category == "Private Law" | cesmData$category == "Perspectives On Law" | cesmData$category == "Mercantile Law" | cesmData$category == "Legal Profession" | cesmData$category == "Law, Other" | cesmData$category == "International Aspects Of Law" | cesmData$category == "Formal Law" | cesmData$category == "Criminal Justice And Corrections" ~ "Law",
  cesmData$category == "Alternative And Complementary Medicine And Medical Systems" | cesmData$category == "Bioethics/Medical Ethics" | cesmData$category == "Biomedical/Medical Engineering"| cesmData$category == "Chiropractic"| cesmData$category == "Clinical Psychology"| cesmData$category == "Cognitive Psychology And Psycholinguistics"| cesmData$category == "Counselling Psychology"| cesmData$category == "Developmental And Child Psychology"| cesmData$category == "Health And Medical Administrative Services"| cesmData$category == "Health Professions and Related Clinical Sciences, Other"| cesmData$category == "Health/Medical Psychology"| cesmData$category == "Medical Clinical Sciences"| cesmData$category == "Medical Illustration And Informatics"| cesmData$category == "Medical Radiologic Technology/Science (Radiography)"| cesmData$category == "Medicine"| cesmData$category == "Movement And Mind-Body Therapies And Education"| cesmData$category == "Optometry"| cesmData$category == "Personality Psychology"| cesmData$category == "Pharmacology And Toxicology"| cesmData$category == "Pharmacy, Pharmaceutical Sciences And Administration"| cesmData$category == "Physiology, Pathology And Related Sciences"| cesmData$category == "Podiatric Medicine/Podiatry"| cesmData$category == "Psychology, General"| cesmData$category == "Psychology, Other"| cesmData$category == "Psychometrics And Applied Psychological Assessment"| cesmData$category == "Rehabilitation And Therapeutic Professions"~"Medical",
  cesmData$category == "Geography And Cartography" | cesmData$category == "Geological/Geophysical Engineering" | cesmData$category == "Geology And Earth Sciences/Geosciences" ~"Natural Science")

#Renaming columns
cesmData <- select(cesmData, -"X")
names(cesmData) <- c("category", "CESM Total 2010", "CESM Total 2011", "CESM Total 2012", "CESM Total 2013", "CESM Total 2014", "CESM Total 2015", "CESM Total 2016", "CESM Total 2017")

#Collapsing rows into categories
cesmDataCategorised <- aggregate(cbind(cesmData$`CESM Total 2010`, cesmData$`CESM Total 2011`, cesmData$`CESM Total 2012`, cesmData$`CESM Total 2013`, cesmData$`CESM Total 2014`, cesmData$`CESM Total 2015`, cesmData$`CESM Total 2016`, cesmData$`CESM Total 2017`), by = list(category = cesmData$category), FUN = sum, na.rm = TRUE)
names(cesmDataCategorised) <- c("category", "CESM Total 2010", "CESM Total 2011", "CESM Total 2012", "CESM Total 2013", "CESM Total 2014", "CESM Total 2015", "CESM Total 2016", "CESM Total 2017")

#Changing NAs to "Non-categorised"
cesmData$category[is.na(cesmData$category)] <- "Non-categorised"

#Collapsing "Non-Categorised"
cesmDataNonCategorised <- aggregate(cbind(cesmData$`CESM Total 2010`, cesmData$`CESM Total 2011`, cesmData$`CESM Total 2012`, cesmData$`CESM Total 2013`, cesmData$`CESM Total 2014`, cesmData$`CESM Total 2015`, cesmData$`CESM Total 2016`, cesmData$`CESM Total 2017`), by = list(category = cesmData$category), FUN = sum, na.rm = TRUE)
names(cesmDataNonCategorised) <- c("category", "CESM Total 2010", "CESM Total 2011", "CESM Total 2012", "CESM Total 2013", "CESM Total 2014", "CESM Total 2015", "CESM Total 2016", "CESM Total 2017")

#CALULCATING GROWTH RATES WITH EXPORT DATA

exportAllYearsCESM <- cesmDataCategorised %>%
  mutate(`CESM GR 2011` = round(((`CESM Total 2011`/sum(`CESM Total 2011`)) - (`CESM Total 2010`/sum(`CESM Total 2010`)))/(`CESM Total 2010`/sum(`CESM Total 2010`)) * 100, digits = 2),
         `CESM GR 2012` = round(((`CESM Total 2012`/sum(`CESM Total 2012`)) - (`CESM Total 2011`/sum(`CESM Total 2011`)))/(`CESM Total 2011`/sum(`CESM Total 2011`)) * 100, digits = 2), `CESM GR 2013` = round(((`CESM Total 2013`/sum(`CESM Total 2013`)) - (`CESM Total 2012`/sum(`CESM Total 2012`)))/(`CESM Total 2012`/sum(`CESM Total 2012`)) * 100, digits = 2), `CESM GR 2014` = round(((`CESM Total 2014`/sum(`CESM Total 2014`)) - (`CESM Total 2013`/sum(`CESM Total 2013`)))/(`CESM Total 2013`/sum(`CESM Total 2013`)) * 100, digits = 2), `CESM GR 2015` = round(((`CESM Total 2015`/sum(`CESM Total 2015`)) - (`CESM Total 2014`/sum(`CESM Total 2014`)))/(`CESM Total 2014`/sum(`CESM Total 2014`)) * 100, digits = 2), `CESM GR 2016` = round(((`CESM Total 2016`/sum(`CESM Total 2016`)) - (`CESM Total 2015`/sum(`CESM Total 2015`)))/(`CESM Total 2015`/sum(`CESM Total 2015`)) * 100, digits = 2), `CESM GR 2017` = round(((`CESM Total 2017`/sum(`CESM Total 2017`)) - (`CESM Total 2016`/sum(`CESM Total 2016`)))/(`CESM Total 2016`/sum(`CESM Total 2016`)) * 100, digits = 2), `CESM Cumulative GR` = round((`CESM GR 2011` + `CESM GR 2012` + `CESM GR 2013` + `CESM GR 2014` + `CESM GR 2015` + `CESM GR 2016` + `CESM GR 2017`)/7, digits = 2))


#EXPORTING TO CSV
write.csv(exportAllYearsCESM, file = "CESM WITH GROWTH RATES.csv")

#Calculating CESM proportions
cesmProportions <- exportAllYearsCESM %>%
  mutate(PropCESM2010 = round((`CESM Total 2010`/sum(`CESM Total 2010`))*100, digits = 2), 
         PropCESM2011 = round((`CESM Total 2011`/sum(`CESM Total 2011`))*100, digits = 2), 
         PropCESM2012 = round((`CESM Total 2012`/sum(`CESM Total 2012`))*100, digits = 2), 
         PropCESM2013 = round((`CESM Total 2013`/sum(`CESM Total 2013`))*100, digits = 2), 
         PropCESM2014 = round((`CESM Total 2014`/sum(`CESM Total 2014`))*100, digits = 2), 
         PropCESM2015 = round((`CESM Total 2015`/sum(`CESM Total 2015`))*100, digits = 2), 
         PropCESM2016 = round((`CESM Total 2016`/sum(`CESM Total 2016`))*100, digits = 2), 
         PropCESM2017 = round((`CESM Total 2017`/sum(`CESM Total 2017`))*100, digits = 2)) %>%
  select(category, PropCESM2010, PropCESM2011, PropCESM2012, PropCESM2013, PropCESM2014, PropCESM2015, PropCESM2016, PropCESM2017)

#EXPORTING PROPORTIONS TO CV
write.csv(cesmProportions, file = "CESM WITH PROPORTIONS.csv")
